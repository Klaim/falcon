<?
   import from nest.action in na

   // As this is a test, we need to create and check our working environment.
   mode = Request.getField("mode","")
   targetDir = "uploads"
   config = [
      "upload_dir" => targetDir,
      "actions" => .[
         na.LinkAction( "view", Nest.AL.NONE, "javascript:viewFile('$file','$path', '"+mode+"');", i"View" )
         na.LinkAction( "view", Nest.AL.NONE, "javascript:choseFile('$file','$path', '"+mode+"');", i"Select" )
      ]
   ]

   s = Nest.service( "Uploader", "", config )
?>
<html>
<head>
   <title>Wiki attachments control</title>
   <? Nest.headings() ?>

<script type="text/javascript">
   function viewFile( name, path )
   {
      window.open( "<?=targetDir ?>/" + path + "/" + name, "View file " + name);
   }

   function choseFile( name, path, mode )
   {
      window.opener.focus();
      window.opener.nest_wiki_insertText( path+"/"+name, mode );
      window.close();
   }
</script>
</head>
<body>
<h1>Wiki attachments control</h1>
<p>Select or manage uploaded files.</p>
<div>
   <? s.render() ?>
</div>
</body>
</html>
