<?
   import from nest.action in na
   import from nest.dbview in dw
   
   editView = dw.DBView( Nest.dm( "notes_db" ).entity("notes") )
   editView.fields = .[
         dw.DBViewField( "inserted", i"Inserted on", {v=> "<b>" + v + "</b>"} )
         dw.DBViewField( "title", i"Title", {v=>"<h2>" + htmlEscape(v) + "</h2>"} )
         dw.DBViewField( "content", i"Content", { v=> htmlEscape(v) } )
      ]

   de = Nest.service( "DataEntry", "",
      [
         "actions" => .[
            na.SubmitAction( "Update", Nest.AL.STAFF, "Update", "cmd", "upd" )
            //na.SubmitAction( "Delete", Nest.AL.STAFF, "Delete!", "cmd", "del" )
         ],
         "skin" => "note_upd",
         "handler" => Nest.pageLink("home"),
         "level" => Nest.AL.USER,
         "view" => editView
      ]
   )
?><html>
<head>
   <title>Your notes</title>
   <?= Nest.headings() ?>
</head>
<body>
   <h1>Modify your note</h1>
   <? if de.allowed() ?>
      <? de.render() ?>
   <? else ?>
      <p>Sorry, you're not allowed tobe here</p>
   <? end ?>
   <br/>
   <p>Click here to <a href="<?= Nest.pageLink('home') ?>">return to home</a> and abandon edit.</p>
   <br/>
</body>
</html>
