<? 
load timestamp
import session
session, mode, status, sdata = pre_data 
?>
<h1>Explicitly named sessions test</h1>
<p>This test checks for session usage allwoing to perform an emulated login/logout sequence.
   Also, the session ID is not saved in cookies, but generated by this script, and propagated
   via  simple GET filed in the <b>my_sid</b> variable.</p>
<p>The user is "master" and the password is "1234".</p>
<? if session ?>
   <!-- We're really logged in! -->
   <p>Welcome, <?= session["user"] ?>!</p>
   <p>You have been around <?= session["times"] ?> times.</p>
   <p>Session started at <?= session["started"] ?>
      <?
      now = TimeStamp().current()
      distance = int((now.msSinceEpoch - session["started"].msSinceEpoch)/1000)
      ?></p>
   <? if "international" in session ?>
      <p>You have the international session item: <?= session["international"] ?></p>
   <? end ?>
   <p>Do you want to <a href="<?= Request.uri ?>&my_sid=<?=sdata.id?>&mode=logout">logout</a>
      or to <a href="<?= Request.uri ?>&my_sid=<?=sdata.id?>">reload this page</a>?</p>

   <?
      // the fun with sessions is that we can change data past output
      session["times"] ++
   ?>

<? else ?>
   <? if mode == "logout" ?>
      <p><b>Logout performed</b>. Goodbye!</p>
   <? elif status ?>
      <!-- Something was wrong. Error is specified in status -->
      <p><b><?= status ?></b>. Please try again.</p>
   <? end ?>

   <!-- in any case, present the login form -->
   <form action="<?= makeLink(Request.gets["p"]) ?>" method="POST">
   <input type="hidden" name="mode" value="login"/>
   User: <input type="text" name="user"/><br/>
   Password: <input type="password" name="pwd"/><br>
   <input type="submit" value="Login"/>
   </form>

<? end ?>

<? 
    > sdata.describe()
if sdata: sdata.save() ?>
