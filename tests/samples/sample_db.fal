//const connectString = "pgsql:dbname=falcon_sample"
//const connectString = "mysql:localhost,jeremy,secret,falcon_sample,0,0,0,"
const connectString = "sqlite3:falcon_sample.db"

class Person( nName, nDob ) from DBIRecord
	_tableName  = "names"
   _primaryKey = "name"
   _persist    = [ "name", "dob" ]
   
	name = nName
   dob = nDob
end

function connect()
	try
		dbh = DBIConnect( connectString )
      return dbh
   catch DBIError in err
   	> err
      > "=== NOTE ==="
      > "Sample requires an existing database connection."
      > "See sample_db.fal for connection information."
      >
      > "Connection string used: '", connectString, "'"
      exit( 1 )
   end
end

function createNamesTable(dbh)
   > "Creating names table"
   tr = dbh.startTransaction()
   tr.execute( "CREATE TABLE names (name varchar(20), dob date)" )
   tr.execute( "INSERT INTO names (name, dob) VALUES ($1, $2)", "John", "1963-08-11" )
   tr.execute( "INSERT INTO names (name, dob) VALUES ($1, $2)", "Jeff", "1978-03-29" )
   tr.execute( "INSERT INTO names (name, dob) VALUES ($1, $2)", "Jane", "1932-10-01" )
   tr.close()
end

function dropNamesTable(dbh)
	> "Droping names table"
	dbh.execute( "DROP TABLE names" )
end

export connect, createNamesTable, dropNamesTable, Person
