/****************************************************************************
* Falcon test suite
*
* CVS-Id: $Id: serialize_array.fal,v 1.1.1.1 2006/10/08 15:05:41 gian Exp $
*
* ID: 107b
* Category: rtl
* Subcategory: serialization
* Short: Array serialization
* Description:
*   Serialization test on arrays.
* [/Description]
*
****************************************************************************/

// we need a stream
stream = StringStream()

array1 = [ "Hello", "world", "an item", 1, 2.2, nil, [2:3] ]
array2 = [ "a", "nested", array1, "array" ]

serialize( stream, array1 )
serialize( stream, array2 )

stream.seek(0)

try
   item1 = deserialize( stream )
   if len( array1 ) != len( item1 ): failure( "Basic" )
   for i = 0 to len( array1 ) - 1
      if array1[i] != item1[i]: failure( "Deep item retrival" )
   end

   item2 = deserialize( stream )
   if len( array2 ) != len( item2 ): failure( "Second deserialization" )
   item3 = item2[2]
   if len( array1 ) != len( item3 ): failure( "Deep deserialization" )
   for i = 0 to len( array1 ) - 1
      if array1[i] != item3[i]: failure( "Deep item retrival 2" )
   end

catch
   failure( "Deserialization failed" )
end

success()

/* End of file */
