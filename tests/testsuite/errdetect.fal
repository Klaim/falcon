/****************************************************************************
* DynLib - Falcon dynamic library loader module - test suite
*
* ID: 0f
* Category: smoke
* Subcategory:
* Short: Error detection
* Description:
*   Basic error detection.
* [/Description]
*
****************************************************************************/

load dynlib

try
   // setup
   l = DynLib( "./test_dynlib." + dynExt() )

   // check an unexisting function via query
   f = l.query( "Yo!" )
   if f != nil: failure( "Found unexisting function" )

   // check an unexsting function via get
   try
      f = l.get( "Yo!" )
      failure( "Error not raised by get on unexisting function" )
   catch DynLibError in e
   end

   // checks invalid return val
   try
      f = l.get( "call_p0_ri", "K" )
      failure( "Invalid retval not detected" )
   catch ParamError in e
   end

   // checks invalid return (by $)
   try
      f = l.get( "call_p0_ri", "$I" )
      failure( "Byref retval not detected" )
   catch ParamError in e
   end

   // checks invalid return (multiple)
   try
      f = l.get( "call_p0_ri", "I U" )
      failure( "Multiple retval not detected" )
   catch ParamError in e
   end

   // checks invalid param
   try
      f = l.get( "call_p0_ri", "I", "K" )
      failure( "Invalid param not detected" )
   catch ParamError in e
   end

   // checks invalid param in sequence
   try
      f = l.get( "call_p0_ri", "I", "I K U" )
      failure( "Invalid param in sequence not detected" )
   catch ParamError in e
   end

   // checks parameter after ...
   try
      f = l.get( "call_p0_ri", "I", "I ... U" )
      failure( "Parameter after ... not detected" )
   catch ParamError in e
   end

   // type checks in other tests.

   success()
catch DynLibError in e
   failure( e.toString() )
end
