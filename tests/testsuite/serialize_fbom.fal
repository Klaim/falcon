/****************************************************************************
* Falcon test suite
*
* CVS-Id: $Id: serialize_fbom.fal,v 1.1 2007/08/03 13:17:07 jonnymind Exp $
*
* ID: 107e
* Category: fbom
* Subcategory: serialization
* Short: Serialization
* Description:
*   Testing serialization/deserialization of standard types.
* [/Description]
*
****************************************************************************/

// we need a stream
stream = StringStream()

item = "Hello world"
item.serialize( stream )
item = 1
item.serialize( stream )
item = nil
item.serialize( stream )
item = 1.3
item.serialize( stream )
item = [3:-1]
item.serialize( stream )
item = [3:]
item.serialize( stream )
item = true
item.serialize( stream )
item = false
item.serialize( stream )
item = "last"
item.serialize( stream )

stream.seek(0)

try
   item = nil
   count = 0
   while item != "last"
      item = stream.readItem()
      count ++
      if count == 1 and item != "Hello world": failure( "first item" )
      if count == 2 and item != 1: failure( "second item" )
      if count == 3 and item != nil: failure( "third item" )
      if count == 4 and item != 1.3: failure( "fourth item" )
      if count == 5 and item != [3:-1]: failure( "fifth item" )
      if count == 6 and item != [3:]: failure( "sixth item" )
      if count == 7 and item != true: failure( "seventh item" )
      if count == 8 and item != false: failure( "eight item" )
   end
catch
   failure( "deserialization failed" )
end

if count != 9: failure( "count of items" )
try
   stream.read(1)
   if not stream.eof(): failure( "Stream was not at eof" )
catch
   failure( "Standard read after deserialization" )
end

success()

/* End of file */
